<!-- Titre en haut de la page -->
{% load static %}

<!DOCTYPE html>
<html lang="fr">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href=" {% static 'css/style.css' %}">
    <link rel="stylesheet" href=" {% static 'css/bootstrap.min.css' %}">

    </head>
    <body>
  

    <div id="content">
        <!-- Contenu de la page -->
    </div>
    <script>
    let isLoading = false;
        
    function loadContent() {
    console.log(isLoading);
    // Empêcher le chargement multiple
    if (isLoading) return; // Ne pas exécuter si une action de navigation est déjà en cours
    isLoading = true;


    // Mettre à jour l'URL sans recharger la page
    history.replaceState({}, '', location.hash);


        var hash = location.hash;
        var content = document.getElementById('content');
        var url = '';
    
        switch(hash) {
            case '#index':
                url = 'index/';
                break;
            case '#connection':
                url = 'connection/';
                break;
            case "#games":
                url = "games/";
                break;
            case '#AI':
                url = 'AI/';
                break;
            case '#register':
                url = 'register/';
                break;
            default:
                url = 'accueil/';
        }
    
        // Utiliser AJAX pour récupérer le contenu
        var xhr = new XMLHttpRequest();
        console.log(" essai pour log URL " + url);
        xhr.open('GET', url, true);
        xhr.onload = function() {
            if (this.status >= 200 && this.status < 400) {
                // Insérer le contenu récupéré dans l'élément 'content'
                content.innerHTML = "";
                content.innerHTML = this.responseText;

                // Créer une nouvelle balise <script>
                var script = document.createElement('script');
    
                // Load the appropriate script based on the URL hash
                switch(hash) {
                    case '#index':
                        console.log("Loading index.js");
                        script.src = "{% static 'scripts/index.js' %}";
                        break;
                    case '#connection':
                        console.log("Loading connection.js");
                        script.src = "{% static 'sripts/connection.js' %}";
                        break;;
                    case "#AI":
                        console.log("Loading AI scripts");
                        var aiScripts = [
                        "{% static 'scripts/three.min.js' %}",
                        "{% static 'scripts/keyboard.js' %}",
                        "{% static 'scripts/game.js' %}",
                        ];
                        aiScripts.forEach(function(src) {
                            setTimeout(function() {

                                var script = document.createElement('script');
                                script.src = src;
                                document.head.appendChild(script);
                            }, 100);
                        });
                        break;
                    case '#accueil':
                        console.log("Loading accueil.js");
                        script.src = "{% static 'scripts/accueil.js' %}";
                        break;
                    case '#register':
                        console.log("Loading register.js");
                        script.src = "{% static 'scripts/register.js' %}";
                        break;
                    default:
                        console.log("no script to load");
                }

                // Ajouter le script à la page après un court délai
                // setTimeout(function() {
                //     document.head.appendChild(script);
                // }, 500);

                    isLoading = false;
                }
                 else {
                // Gérer les erreurs
                content.innerHTML = 'Erreur lors du chargement de la section.';
                isLoading = false;
            }
        };
        xhr.onerror = function() {
            // Gérer les erreurs de réseau
            content.innerHTML = 'Erreur de réseau.';

        };
        xhr.send();

    }
    
    // Écouter l'événement hashchange
    window.addEventListener('hashchange', loadContent);

    // Écouter l'événement popstate pour gérer le retour et le précédent
    window.addEventListener('popstate', loadContent);

    
    // Charger le contenu au chargement initial de la page
    document.addEventListener('DOMContentLoaded', loadContent);

    </script>
    </body>
</html> 


<!-- modification a faire pour load les scripts dans le head de la page -->

<!-- xhr.onload = function() {
    if (this.status >= 200 && this.status < 400) {
        // Insérer le contenu récupéré dans l'élément 'content'
        content.innerHTML = "";
        content.innerHTML = this.responseText;

        // Créer une nouvelle balise <script> et charger le script approprié
        var script = document.createElement('script');
        switch(hash) {
            case '#index':
                console.log("Loading index.js");
                script.src = "{% static 'scripts/index.js' %}";
                break;
            case '#connection':
                console.log("Loading connection.js");
                script.src = "{% static 'scripts/connection.js' %}";
                break;
            case "#AI":
                console.log("Loading AI scripts");
                var aiScripts = [
                    "{% static 'scripts/keyboard.js' %}",
                    "{% static 'scripts/game.js' %}",
                    "{% static 'scripts/three.min.js' %}"
                ];
                aiScripts.forEach(function(src) {
                    var script = document.createElement('script');
                    script.src = src;
                    document.head.appendChild(script);
                });
                break;
            case '#accueil':
                console.log("Loading accueil.js");
                script.src = "{% static 'scripts/accueil.js' %}";
                break;
            case '#register':
                console.log("Loading register.js");
                script.src = "{% static 'scripts/register.js' %}";
                break;
            default:
                console.log("no script to load");
        }
        document.head.appendChild(script);
        isLoading = false;
    } else {
        // Gérer les erreurs
        content.innerHTML = 'Erreur lors du chargement de la section.';
        isLoading = false;
    }
}; -->